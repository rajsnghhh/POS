<div class="content-area-pos ">
    <form autocomplete="off" [formGroup]="salesOrderForm">
        <div class="row">
            <div class="col-sm-12 col-md-12 col-lg-12">
                <div class="row mt-3">
                    <div class="col-sm-12 col-12 order-2 order-md-1 col-md-9">
                        <div class="card leftbar">
                            <div class="card-body">
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <label class="text-danger">{{'CUSTOMER_NAME' | translate}} *</label>
                                    <div role="group" class="input-group input-customer">
                                        <mat-select formControlName="customerId" [dir]="langDir"
                                            placeholder="{{'SELECT_CUSTOMER' | translate}}" class="form-control">
                                            <input class="form-control w-100" formControlName="filerCustomer"
                                                focused="'true'" type="text" autocomplete="off"
                                                placeholder="{{'SEARCH_OTHER_CUSTOMERS' | translate}} ">
                                            <mat-divider></mat-divider>
                                            <mat-option *ngFor="let customer of customers" [value]="customer.id">
                                                {{customer.customerName}} ({{customer.mobileNo}})
                                            </mat-option>
                                            <mat-option [value]="" *ngIf="customers.length==0">
                                                {{"NO_RECORDS" | translate}}
                                            </mat-option>
                                        </mat-select>
                                    </div>
                                    <div
                                        *ngIf="salesOrderForm.get('customerId').touched && salesOrderForm.get('customerId').errors">
                                        <div class="text-danger"
                                            *ngIf="salesOrderForm.get('customerId').errors?.required">
                                            {{'CUSTOMER_NAME_IS_REQUIRED' | translate}}
                                        </div>
                                    </div>
                                </div><br>
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <div class="row">
                                        <div class="col-sm-12" formArrayName="salesOrderItems">
                                            <div class="row">
                                                <div class="col">
                                                    <div class="table-responsive zoomin">
                                                        <table class="table table-bordered table-hover">
                                                            <tr>
                                                                <th class="table-column-200">
                                                                    {{'PRODUCT' | translate}}
                                                                </th>
                                                                <th class="table-column-100">
                                                                    {{'UNIT' | translate}}
                                                                </th>
                                                                <th class="table-column-80">
                                                                    {{'PRICE' | translate}}
                                                                </th>
                                                                <th class="table-column-50">
                                                                    {{'QUANTITY' | translate}}
                                                                </th>
                                                                <th class="table-column-70">
                                                                    {{'STOCK' | translate}}
                                                                </th>
                                                                <!-- <th class="table-column-100">
                                                                    {{'DISCOUNT' | translate}}%
                                                                </th> -->
                                                                <!-- <th class="table-column-100">
                                                                    Concession
                                                                </th> -->
                                                                <!-- <th class="table-column-100">
                                                                    {{'TAX' | translate}}
                                                                </th> -->
                                                                <th class="table-column-120">
                                                                    {{'TOTAL' | translate}}
                                                                </th>

                                                                <th class="table-column-20">
                                                                    Action
                                                                </th>
                                                                <!-- <th style="text-align: center;">
                                                                    <i class="fas fa-trash-alt"
                                                                        style="opacity:0.5; filter:alpha(opacity=50);"></i>
                                                                </th> -->
                                                            </tr>
                                                            <tr [formGroupName]="i"
                                                                *ngFor="let salesOrderItem of salesOrderItemsArray?.controls; let i = index">

                                                                <td>

                                                                    <input class="form-control w-100"
                                                                        formControlName="productName" focused="'true'"
                                                                        type="text" autocomplete="off" disabled>
                                                                    <!-- <div class="input-group">
                                                                            <mat-select [dir]="langDir"
                                                                                formControlName="productName"
                                                                                placeholder="{{'SELECT_PRODUCT' | translate}}"
                                                                                class="form-control"  (selectionChange)="onProductSelectionChange($event.value,i)" > -->
                                                                    <!--  formControlName="filterProductValue" -->
                                                                    <!-- <input class="form-control w-100"
                                                                                    formControlName="productName"
                                                                                    focused="'true'" type="text"
                                                                                    autocomplete="off"
                                                                                    placeholder="{{'SEARCH_OTHER_PRODUCTS' |translate}}">
                                                                                <mat-divider></mat-divider>
                                                                                <div class="suggestionbox"> <mat-option
                                                                                        [dir]="langDir"
                                                                                        *ngFor="let a of filterProducts;let i = index"
                                                                                        [value]="a.id"> -->
                                                                    <!-- 
                                                                                            (click)="onProductSelect(a,i)" -->
                                                                    <!-- {{a.name}}
                                                                                    </mat-option>
                                                                                    <mat-option [value]=""
                                                                                        *ngIf="filterProducts[i]?.length==0">
                                                                                        {{'NO_RECORDS' | translate}}
                                                                                    </mat-option>
                                                                                </div>
    
                                                                            </mat-select>  </div> -->
                                                                    <!-- <div class="input-group">
                                                                        <mat-select [dir]="langDir"
                                                                            formControlName="productName"
                                                                            placeholder="{{'SELECT_PRODUCT' | translate}}"
                                                                            (selectionChange)="onProductSelect($event.value,i)"
                                                                            class="form-control">
                                                                            <input class="form-control w-100"
                                                                                formControlName="filterProductValue"
                                                                                focused="'true'" type="text"
                                                                                autocomplete="off"
                                                                                placeholder="{{'SEARCH_OTHER_PRODUCTS' |translate}}">
                                                                            <mat-divider></mat-divider>
                                                                            <div class="suggestionbox"> <mat-option
                                                                                    [dir]="langDir"
                                                                                    *ngFor="let a of filterProducts;let i = index"
                                                                                    [value]="a.id">
                                                                                    {{a.name}}
                                                                                </mat-option>
                                                                                <mat-option [value]=""
                                                                                    *ngIf="filterProducts[i]?.length==0">
                                                                                    {{'NO_RECORDS' | translate}}
                                                                                </mat-option>
                                                                            </div> 

                                                                        </mat-select>
                                                                    </div> -->

                                                                    <!-- <div
                                                                        *ngIf="purchaseOrderItem.get('productId').touched && purchaseOrderItem.get('productId').errors">
                                                                        <div class="text-danger"
                                                                            *ngIf="purchaseOrderItem.get('productId').errors?.required">
                                                                            {{'PRODUCT_IS_REQUIRED' | translate}}
                                                                        </div>
                                                                    </div> -->
                                                                </td>
                                                                <td>
                                                                    <mat-select [dir]="langDir" formControlName="unitId"
                                                                        (selectionChange)="onSelectionChange($event.value,i)"
                                                                        class="form-control">
                                                                        <mat-option [dir]="langDir"
                                                                            *ngFor="let a of unitsMap[i]"
                                                                            [value]="a.id">
                                                                            {{a.name}}
                                                                        </mat-option>
                                                                    </mat-select>
                                                                    <div
                                                                        *ngIf="salesOrderItem.get('unitId').touched && salesOrderItem.get('unitId').errors">
                                                                        <div class="text-danger"
                                                                            *ngIf="salesOrderItem.get('unitId').errors?.required">
                                                                            {{'UNIT_IS_REQUIRED' | translate}}
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <input class="form-control" type="number"
                                                                        (change)="onUnitPriceChange()"
                                                                        formControlName="unitPrice"
                                                                        placeholder="{{'UNIT_PER_PRICE' | translate}}">
                                                                    <div
                                                                        *ngIf="salesOrderItem.get('unitPrice').touched && salesOrderItem.get('unitPrice').errors">
                                                                        <div class="text-danger"
                                                                            *ngIf="salesOrderItem.get('unitPrice').errors?.required">
                                                                            {{'UNIT_PER_PRICE_IS_REQUIRED' | translate}}
                                                                        </div>
                                                                        <div class="text-danger"
                                                                            *ngIf="salesOrderItem.get('unitPrice').errors?.min">
                                                                            {{"PRICE_SHOULD_BE_MORE_THEN_0" |
                                                                            translate}}
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <input class="form-control" type="text"
                                                                        (change)="onQuantityChange(salesOrderItem)"
                                                                        formControlName="quantity"
                                                                        (keyup)="quantityCheck($event, salesOrderItem)"
                                                                        placeholder="{{'QUANTITY' | translate}}">
                                                                    <div
                                                                        *ngIf="salesOrderItem.get('quantity').touched && salesOrderItem.get('quantity').errors">
                                                                        <div class="text-danger"
                                                                            *ngIf="salesOrderItem.get('quantity').errors?.required">
                                                                            {{'QUANTITY_IS_REQUIRED' | translate}}
                                                                        </div>
                                                                        <div class="text-danger"
                                                                            *ngIf="salesOrderItem.get('quantity').errors?.min">
                                                                            {{"QUANTITY_SHOULD_BE_MORE_THEN_0" |
                                                                            translate}}
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <!-- <td>
                                                                    <input class="form-control" type="text"
                                                                        (change)="onQuantityChange(salesOrderItem)" 
                                                                        formControlName="quantity"
                                                                        (keyup)="quantityCheck($event, salesOrderItem)"
                                                                        placeholder="{{'QUANTITY' | translate}}">
                                                                    <div
                                                                        *ngIf="salesOrderItem.get('quantity').touched && salesOrderItem.get('quantity').errors">
                                                                        <div class="text-danger"
                                                                            *ngIf="salesOrderItem.get('quantity').errors?.required">
                                                                            {{'QUANTITY_IS_REQUIRED' | translate}}
                                                                        </div>
                                                                        <div class="text-danger"
                                                                            *ngIf="salesOrderItem.get('quantity').errors?.min">
                                                                            {{"QUANTITY_SHOULD_BE_MORE_THEN_0" |
                                                                            translate}}
                                                                        </div>
                                                                    </div>
                                                                </td> -->
                                                                <td>
                                                                    <input class="form-control w-100" disabled
                                                                        formControlName="stock" focused="'true'"
                                                                        type="text" autocomplete="off">
                                                                </td>
                                                                <!-- <td>
                                                                    <input class="form-control"
                                                                        formControlName="discountPercentage"
                                                                        (change)="onDiscountChange()"
                                                                        placeholder="{{'DISCOUNT' | translate}}">
                                                                    <div class="text-danger"
                                                                        *ngIf="salesOrderItem.get('discountPercentage').errors?.min">
                                                                        {{"DISCOUNT_SHOULD_BE_MORE_THEN_0" | translate}}
                                                                    </div>
                                                                </td> -->
                                                                <!-- <td class="text-center">
                                                                    23
                                                                </td> -->
                                                                <!-- <td>
                                                                    <mat-select [dir]="langDir"
                                                                        formControlName="taxValue"
                                                                        placeholder="Select Tax"
                                                                        (selectionChange)="onTaxSelectionChange()"
                                                                        class="form-control" multiple>
                                                                        <mat-option *ngFor="let tax of taxsMap[i]"
                                                                            [value]="tax.id">{{tax.name}}
                                                                            ({{tax.percentage}}%)
                                                                        </mat-option>
                                                                    </mat-select>
                                                                    <div
                                                                        *ngIf="salesOrderItem.get('taxValue').touched && salesOrderItem.get('taxValue').errors">
                                                                        <div class="text-danger"
                                                                            *ngIf="salesOrderItem.get('taxValue').errors?.required">
                                                                            {{'TAX_IS_REQUIRED' | translate}}
                                                                        </div>
                                                                    </div>
                                                                </td> -->
                                                                <td>
                                                                    {{ salesOrderItem.get('quantity').value |
                                                                    quantitiesunitprice :
                                                                    salesOrderItem.get('unitPrice').value
                                                                    : salesOrderItem.get('discountPercentage').value:
                                                                    salesOrderItem.get('taxValue').value: taxsMap[i] |
                                                                    customRound}}
                                                                    <!-- <div class="text-danger"
                                                                        *ngIf="salesOrderItem.get('taxValue').value">
                                                                        {{"TAX_AMOUNT" | translate}}: {{
                                                                        salesOrderItem.get('quantity').value |
                                                                        quantitiesunitpriceTax :
                                                                        salesOrderItem.get('unitPrice').value :
                                                                        salesOrderItem.get('discountPercentage').value :
                                                                        salesOrderItem.get('taxValue').value: taxsMap[i]
                                                                        |
                                                                        customCurrency }}
                                                                    </div> -->
                                                                </td>
                                                                <td>
                                                                    <button type="button"
                                                                        *ngIf="salesOrderItemsArray?.controls.length > 0"
                                                                        (click)="onRemoveSalesOrderItem(i)"
                                                                        mat-icon-button aria-label="Action">
                                                                        <mat-icon class="btn-danger">delete_forever
                                                                        </mat-icon>
                                                                    </button>
                                                                    <!-- <button type="button"
                                                                        *ngIf="i === salesOrderItemsArray?.controls.length - 1"
                                                                        (click)="onAddAnotherProduct(i)" mat-icon-button
                                                                        aria-label="Action"
                                                                        (keydown.Tab)="handleTab($event, i)">
                                                                        <mat-icon class="btn-primary">add</mat-icon>
                                                                    </button> -->
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12 col-12 order-2 order-md-1 col-md-4" style="padding: 5px;">
                                            <label class="text-danger paymentTypeHeading" for="paymentMethod">
                                                {{"PAYING_BY" | translate}}
                                                *</label>
                                            <mat-select [(ngModel)]="paymentselect" [dir]="langDir"
                                                placeholder="{{'SELECT_PAYING_BY'| translate }}"
                                                class="form-control paymentType" name="paymentselect"
                                                [ngModelOptions]="{standalone: true}">
                                                <mat-option [dir]="langDir"
                                                    *ngFor="let paymentMethod of paymentMethodslist"
                                                    [value]="paymentMethod?.id">
                                                    {{paymentMethod?.id | paymentmethod}}
                                                </mat-option>
                                            </mat-select>
                                        </div>
                                        <div class="col-sm-12 col-12 order-2 order-md-1 col-md-8">
                                            <div class="row" style="margin-top: 30px;">
                                                <!-- <div class="col-10 text-right font-weight-bold">
                                                    {{"SUB_TOTAL_BEFORE_DISCOUNT" | translate}}:
                                                </div> -->
                                                <div class="col-9 text-right font-weight-bold">
                                                    Sub Total :
                                                </div>
                                                <div class="col-3 text-left  font-weight-bold">
                                                    {{totalBeforeDiscount | customRound}}
                                                </div>
                                            </div>
                                            <!-- <div class="row">
                                                <div class="col-10 text-right font-weight-bold">
                                                    {{'TOTAL_DISCOUNT' | translate}}:
                                                </div>
                                                <div class="col-2 text-left text-danger  font-weight-bold">
                                                    {{totalDiscount | customCurrency}}
                                                </div>
                                            </div> -->
                                            <!-- <div class="row">
                                                <div class="col-10 text-right font-weight-bold">
                                                    {{'TOTAL_TAX' | translate}}:
                                                </div>
                                                <div class="col-2 text-left  font-weight-bold">
                                                    {{totalTax | customCurrency}}
                                                </div>
                                            </div> -->
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-12">
                                            <mat-divider></mat-divider>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-10 text-right font-weight-bold">
                                            {{"GRAND_TOTAL" | translate}} :
                                        </div>
                                        <div class="col-2 text-left font-weight-bold">
                                            <!--    {{grandTotal | customCurrency}} -->
                                            {{grandTotal | customRound }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 mb-1 text-center">
                                        <button type="button" (click)="onSalesOrderSubmit()"
                                            class="btn btn-success btn-sm m-right-10 "
                                            *hasClaim="['SO_ADD_SO','SO_UPDATE_SO','SO_RETURN_SO','POS_POS']">
                                            <i class="fas fa-save"></i> Save & Print</button>
                                        <!-- <button type="button" (click)="onSaveAndNew()"
                                            class="btn btn-success btn-sm m-right-10 "
                                            *hasClaim="['SO_ADD_SO','SO_UPDATE_SO','SO_RETURN_SO','POS_POS']">
                                            <i class="fas fa-save"></i> {{'SAVE_AND_NEW' | translate}}</button> -->
                                        <button type="button" (click)="onSalesOrderList()"
                                            class="btn btn-danger btn-sm"><i class="fas fa-times-circle"></i>
                                            {{'CANCEL' | translate}}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-12 order-1 order-md-2 col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="custom-checkbox">
                                    <input type="checkbox" id="party" name="party" class="styled-checkbox"
                                        (change)="checkPartyOrder()">
                                    <label for="party" class="styled-label">
                                        <h5>{{"Advance Order" | translate}}</h5>
                                    </label>
                                </div>
                                <hr>
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <h6>{{"PRODUCT" | translate}}</h6>
                                    <input #filterValue class="form-control w-100" (onDetected)="onDetected($event)"
                                        ngxBarCodePut formControlName="filterProductValue" type="text"
                                        autocomplete="off"
                                        placeholder="{{'SEARCH_OTHER_PRODUCTS_WITH_NAME_AND_SCAN_BARCODE' | translate}}">
                                </div>
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <div class="form-row mt-3 card-scroller">
                                        <div class="col-sm-6 col-lg-4" *ngFor="let a of filterProducts;let i = index">
                                            <div class="card card-pos" (click)="onProductSelect(a,i)">
                                                <div class="card-body">
                                                    <ng-container *ngIf="a.productUrl; else noImage">
                                                        <img [src]="baseUrl + a.productUrl" class="img-circle " />
                                                    </ng-container>
                                                    <ng-template #noImage>
                                                        <img src="assets/images/no-preview.jpg" class="img-circle "
                                                            alt="{{'PRODUCT_IMAGE' | translate}}">
                                                    </ng-template>
                                                    <div class="text-center card-text">{{a.name | slice:0:10}}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <br />
                                    <div *ngIf="filterProducts.length == 0"> <b> {{'NO_DATA_FOUND' | translate}}</b>
                                    </div>
                                </div>

                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <h6>Baggage</h6>
                                </div>
                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <div class="form-row mt-3 card-scroller">
                                        <div class="col-sm-6 col-lg-4" *ngFor="let a of filterPackage;let i = index">
                                            <div class="card card-pos" (click)="onProductSelect(a,i)">
                                                <div class="card-body">
                                                    <ng-container *ngIf="a.productUrl; else noImage">
                                                        <img [src]="baseUrl + a.productUrl" class="img-circle " />
                                                    </ng-container>
                                                    <ng-template #noImage>
                                                        <img src="assets/images/no-preview.jpg" class="img-circle "
                                                            alt="{{'PRODUCT_IMAGE' | translate}}">
                                                    </ng-template>
                                                    <div class="text-center card-text">{{a.name | slice:0:10}}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <br />
                                    <div *ngIf="filterPackage.length == 0"> <b> {{'NO_DATA_FOUND' | translate}}</b>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div class="loading-shade" *ngIf="isLoading">
        <mat-spinner *ngIf="isLoading"></mat-spinner>
    </div>
</div>

<ng-container *ngIf="salesOrderForThermalInvoice">
    <app-salesorder-thermal-invoice [salesOrder]="salesOrderForThermalInvoice"></app-salesorder-thermal-invoice>
</ng-container>